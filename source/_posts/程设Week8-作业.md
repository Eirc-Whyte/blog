---
title: ç¨‹è®¾Week8-ä½œä¸š
date: 2020-04-12 22:25:31
tags:
- å·®åˆ†çº¦æŸ
- æ‹“æ‰‘æ’åº
- Kosaraju
- ç¼©ç‚¹
categories:
- ç¨‹åºè®¾è®¡æ€ç»´ä¸å®è·µ
thumbnail: /gallery/chengshe.png
---

DAGä»¥åŠæŠŠä¸æ˜¯DAGçš„é¢˜æŠ½è±¡æˆDAG

<!--more-->

### å‰ç½®çŸ¥è¯†

#### å·®åˆ†çº¦æŸ

- ä»€ä¹ˆæ˜¯å·®åˆ†çº¦æŸç³»ç»Ÿï¼š

  > - ä¸€ç§ç‰¹æ®Šçš„ n å…ƒä¸€æ¬¡ä¸ç­‰å¼ç»„ï¼Œå®ƒåŒ…å« nä¸ªå˜é‡ä»¥åŠmä¸ªçº¦æŸæ¡ä»¶ã€‚ 
  >
  > - æ¯ä¸ªçº¦æŸæ¡ä»¶æ˜¯ç”±ä¸¤ä¸ªå…¶ä¸­çš„å˜é‡åšå·®æ„æˆçš„ï¼Œå½¢å¦‚$ğ‘¥_iâˆ’ğ‘¥_jâ‰¤ğ‘_k$ï¼Œ å…¶ä¸­$c_k$æ˜¯å¸¸æ•°ï¼ˆå¯ä»¥æ˜¯éè´Ÿæ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯è´Ÿæ•°ï¼‰ã€‚
  > - æˆ‘ä»¬è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼šæ±‚ä¸€ç»„è§£$ğ‘¥_1=ğ‘_1,ğ‘¥_2=ğ‘_2,â€¦,ğ‘¥_n=ğ‘_n$ï¼Œä½¿å¾—æ‰€æœ‰çš„çº¦æŸæ¡ä»¶å¾—åˆ°æ»¡è¶³ï¼Œå¦åˆ™åˆ¤æ–­å‡ºæ— è§£

- å¦‚ä½•æ±‚è§£ï¼Ÿ

  > - å¯¹äºå·®åˆ†çº¦æŸä¸­çš„æ¯ä¸€ä¸ªä¸ç­‰å¼çº¦æŸ$ğ‘¥_iâˆ’ğ‘¥_jâ‰¤ğ‘_k$éƒ½å¯ä»¥ç§»é¡¹å˜å½¢ä¸º $ğ‘¥_iâ‰¤ğ‘_k+ğ‘¥_j$å¦‚æœä»¤$ğ‘_k=ğ‘¤(ğ‘–,ğ‘—)ï¼Œğ‘‘ğ‘–ğ‘ _ğ‘–=ğ‘¥_iï¼Œğ‘‘ğ‘–ğ‘ _ğ‘—=x_j$ï¼Œé‚£ä¹ˆåŸå¼å˜ä¸º$ğ‘‘ğ‘–ğ‘ _ğ‘–â‰¤ ğ‘‘ğ‘–ğ‘ _ğ‘—+ğ‘¤(ğ‘–,ğ‘—)$ï¼Œä¸æœ€çŸ­è·¯é—®é¢˜ä¸­çš„æ¾å¼›æ“ä½œç›¸ä¼¼
  > - æˆ‘ä»¬å¯ä»¥æŠŠå˜é‡$ğ‘¥_i$çœ‹ä½œå›¾ä¸­çš„ä¸€ä¸ªç»“ç‚¹ï¼Œå¯¹äºæ¯ä¸ªä¸ç­‰å¼çº¦æŸ$ğ‘¥_iâˆ’ ğ‘¥_jâ‰¤ğ‘_k$ï¼Œä»ç»“ç‚¹ğ‘—åˆ°èŠ‚ç‚¹ğ‘–è¿ä¸€æ¡é•¿åº¦ä¸º$c_k $çš„æœ‰å‘è¾¹ã€‚åœ¨å›¾ä¸Šæ±‚æœ€çŸ­è·¯å³å¯æ±‚å¾—æœ€å¤§è§£ ï¼ˆ$\textbf{x} \leq \textbf{c}$ä¸­çš„ $ \textbf{x} $ä¸ºä¸Šç•Œï¼‰ã€‚

- å‡ºç°è´Ÿç¯ï¼Ÿ

  > - å¦‚æœè·¯å¾„ä¸­å­˜åœ¨è´Ÿç¯åˆ™è¡¨ç°ä¸ºæœ€çŸ­è·¯çš„æ— é™å°ï¼Œå³æœ€çŸ­è·¯ä¸å­˜åœ¨
  > - åœ¨ä¸ç­‰å¼çº¦æŸä¸Šè¡¨ç°ä¸º$ğ‘¥_iâˆ’ğ‘¥_jâ‰¤ğ‘_k$ä¸­çš„Tä¸ºæ— é™å° 
  > - å¾—å‡ºçš„ç»“è®ºå°±æ˜¯$x_i$çš„ç»“æœä¸å­˜åœ¨ 
  > - å¯ä»¥é€šè¿‡Bellmanç®—æ³•æˆ–è€…é˜Ÿåˆ—ä¼˜åŒ–çš„Bellmanç®—æ³•ï¼ˆSPFAï¼‰æ¥åˆ¤ æ–­è´Ÿç¯æ˜¯å¦å­˜åœ¨

- ç‚¹`i`ä¸å¯è¾¾ï¼Ÿ

  > - è¯´æ˜`i`ä¸1ä¹‹é—´æ²¡æœ‰çº¦æŸå…³ç³»ï¼Œ$x_i$å¯ä»¥æ˜¯ä»»æ„å€¼ã€‚

### A-[åŒºé—´é€‰ç‚¹ II](https://vjudge.net/contest/367400#problem/A)

#### é¢˜ç›®æè¿°ï¼š

ç»™å®šä¸€ä¸ªæ•°è½´ä¸Šçš„ n ä¸ªåŒºé—´ï¼Œè¦æ±‚åœ¨æ•°è½´ä¸Šé€‰å–æœ€å°‘çš„ç‚¹ä½¿å¾—ç¬¬ i ä¸ªåŒºé—´ [ai, bi] é‡Œè‡³å°‘æœ‰ ci ä¸ªç‚¹

ä½¿ç”¨å·®åˆ†çº¦æŸç³»ç»Ÿçš„è§£æ³•è§£å†³è¿™é“é¢˜

##### è¾“å…¥

è¾“å…¥ç¬¬ä¸€è¡Œä¸€ä¸ªæ•´æ•° n è¡¨ç¤ºåŒºé—´çš„ä¸ªæ•°ï¼Œæ¥ä¸‹æ¥çš„ n è¡Œï¼Œæ¯ä¸€è¡Œä¸¤ä¸ªç”¨ç©ºæ ¼éš”å¼€çš„æ•´æ•° aï¼Œb è¡¨ç¤ºåŒºé—´çš„å·¦å³ç«¯ç‚¹ã€‚1 <= n <= 50000ï¼Œ 0 <= ai <= bi <= 50000 å¹¶ä¸” 1 <= ci <= bi - ai+1ã€‚

##### è¾“å‡º

è¾“å‡ºä¸€ä¸ªæ•´æ•°è¡¨ç¤ºæœ€å°‘é€‰å–çš„ç‚¹çš„ä¸ªæ•°

#### é¢˜ç›®åˆ†æ

- å¯ä»¥å¯¹æ•°è½´ä¸Šç‚¹åˆ†å¸ƒçš„å‰ç¼€å’Œæ•°ç»„`r`åšå·®åˆ†çº¦æŸï¼š

  $r[b_i] - r[a_i-1] \geq c_i$
  
- åŒæ—¶ï¼Œæ¯ä¸ªç‚¹æœ€å¤šæ”¾ä¸€ä¸ªç‚¹ï¼Œæœ€å°‘æ”¾0ä¸ªç‚¹ï¼š

  $r[i] - r[i-1] \leq 1$

  $r[i] - r[i-1] \geq 0$

- ç›´æ¥è·‘æœ€çŸ­è·¯ï¼Œå¹¶è¾“å‡º`dis[max(bi)]`å³å¯

- äº¿äº›ç»†èŠ‚ï¼š
  - æ³¨æ„ç»™å®šçš„å·¦å³åŒºé—´ä¸ä¸€å®šæ˜¯ä»1å¼€å§‹çš„ï¼Œè¦è‡ªå·±è®°å½•ï¼›
  - æ³¨æ„å…ˆç»Ÿä¸€ä¸ç­‰å·ï¼›
  - è¿™æ³¢åˆå¡vectorï¼Œè¿˜æ˜¯è€å®ç”¨å‰å‘æ˜Ÿ

#### ä»£ç 

```c++
using namespace std;
const int maxx = 5e4+10;
const int inf = 0x3f3f3f3f;
int n,dis[maxx];
bool inq[maxx];

struct rec{
    int v,w,next;
}edge[maxx*4];
int head[maxx],p;
void add(int a,int b,int c){
    p++;
    edge[p].v = b;
    edge[p].w = c;
    edge[p].next = head[a];
    head[a] = p;
}
void spfa(int s){
    for(int i = 1;i<=n;i++){
        dis[i] = inf;
        inq[i] = 0;
    }
    dis[s] = 0;
    queue<int> q;
    q.push(s);
    inq[s] = 1;
    while(q.size()){
        int h = q.front();
        inq[h] = 0;
        q.pop();
        for(int i = head[h];i;i = edge[i].next){
            int v = edge[i].v;
            int w = edge[i].w;
            if(dis[h] + w < dis[v]){
                dis[v] = dis[h] + w;
                if(!inq[v]){
                    inq[v] = 1;
                    q.push(v);
                }
            }
        }
    }
}
int main(){
    ios::sync_with_stdio(false);
    int cnt = 0,s = inf;
    n = 0;
    cin>>cnt;
    for(int i = 1;i<=cnt;i++){
        int a,b,c;
        cin>>a>>b>>c;
        add(a-1,b,-c);
        n = max(n,b);
        s = min(s,a-1);
    }
    for(int i = s;i<n;i++){
        add(i+1,i,1);
        add(i,i+1,0);
    }
    spfa(s);
    cout<<-dis[n];
    return 0;
}
```

### B-[çŒ«çŒ«å‘å‰å†²](https://vjudge.net/contest/367400#problem/B)

#### é¢˜ç›®æè¿°

æ‹“æ‰‘æ’åº

##### è¾“å…¥

è¾“å…¥æœ‰è‹¥å¹²ç»„ï¼Œæ¯ç»„ä¸­çš„ç¬¬ä¸€è¡Œä¸ºäºŒä¸ªæ•°Nï¼ˆ1<=N<=500ï¼‰ï¼ŒMï¼›å…¶ä¸­Nè¡¨ç¤ºçŒ«çŒ«çš„ä¸ªæ•°ï¼ŒMè¡¨ç¤ºæ¥ç€æœ‰Mè¡Œçš„è¾“å…¥æ•°æ®ã€‚æ¥ä¸‹æ¥çš„Mè¡Œæ•°æ®ä¸­ï¼Œæ¯è¡Œä¹Ÿæœ‰ä¸¤ä¸ªæ•´æ•°P1ï¼ŒP2è¡¨ç¤ºå³ç¼–å·ä¸º P1 çš„çŒ«çŒ«èµ¢äº†ç¼–å·ä¸º P2 çš„çŒ«çŒ«ã€‚

##### è¾“å‡º

ç»™å‡ºä¸€ä¸ªç¬¦åˆè¦æ±‚çš„æ’åã€‚è¾“å‡ºæ—¶çŒ«çŒ«çš„ç¼–å·ä¹‹é—´æœ‰ç©ºæ ¼ï¼Œæœ€åä¸€ååé¢æ²¡æœ‰ç©ºæ ¼!

å…¶ä»–è¯´æ˜ï¼šç¬¦åˆæ¡ä»¶çš„æ’åå¯èƒ½ä¸æ˜¯å”¯ä¸€çš„ï¼Œæ­¤æ—¶è¦æ±‚è¾“å‡ºæ—¶ç¼–å·å°çš„é˜Ÿä¼åœ¨å‰ï¼›è¾“å…¥æ•°æ®ä¿è¯æ˜¯æ­£ç¡®çš„ï¼Œå³è¾“å…¥æ•°æ®ç¡®ä¿ä¸€å®šèƒ½æœ‰ä¸€ä¸ªç¬¦åˆè¦æ±‚çš„æ’åã€‚

#### é¢˜ç›®åˆ†æ

- å°±æ˜¯ç®€å•ç²—æš´çš„æ‹“æ‰‘æ’åºï¼Œåªè®°å½•è¾¹ï¼Œç›´æ¥ç”¨å †æ’åºç¼–å·å°±å¯ã€‚æ¯æ¬¡å°†å…¥åº¦ä¸º0çš„ç‚¹å‹è¿›å»ï¼Œå¼¹å‡ºæ¥å †é¡¶çš„èŠ‚ç‚¹å»æ›´æ–°ä¸å…¶ç›¸è¿çš„ç‚¹ï¼Œå¹¶æŠŠæ›´æ–°ä¹‹åå…¥åº¦å˜æˆ0çš„èŠ‚ç‚¹å‹è¿›å †ã€‚
- å¤šç»„æ•°æ®ï¼Œæ¯æ¬¡è®°å¾—æ¸…ç©ºã€‚
- ä¸æ”¯æŒc++11ï¼Œä¸èƒ½ç”¨autoæœ‰ç‚¹éš¾å—ã€‚

#### ä»£ç 

```c++
using namespace std;
int n,m;
vector<int> edge[600];
int d[600];
int main(){
    n,m;
    while(cin>>n>>m){
        priority_queue<int> q;
        for(int i = 1;i<=m;i++){
            int a,b;
            cin>>a>>b;
            edge[a].push_back(b);
            d[b]++;
        }
        for(int i = 1;i<=n;i++){
            if(d[i] == 0) q.push(-i);
        }
        int cnt = 0;
        while(q.size()){
            if(cnt == n-1)break;
            int u = -q.top();
            cout<<u<<" ";
            q.pop();
            cnt++;
            int len = edge[u].size();
            for(int i = 0;i<len;i++){
                d[edge[u][i]]--;
                if(d[edge[u][i]] == 0){
                    q.push(-edge[u][i]);
                }
            }
        }
        cout<<-q.top()<<"\n";
        for(int i = 0;i<=n;i++){
            d[i] = 0;
            edge[i].clear();
        }
    }
}
```

### C-[ç­é•¿ç«é€‰](https://vjudge.net/contest/367400#problem/C)

#### é¢˜ç›®æè¿°

å¤§å­¦ç­çº§é€‰ç­é•¿ï¼ŒN ä¸ªåŒå­¦å‡å¯ä»¥å‘è¡¨æ„è§ è‹¥æ„è§ä¸º A B åˆ™è¡¨ç¤º A è®¤ä¸º B åˆé€‚ï¼Œæ„è§å…·æœ‰ä¼ é€’æ€§ï¼Œå³ A è®¤ä¸º B åˆé€‚ï¼ŒB è®¤ä¸º C åˆé€‚ï¼Œåˆ™ A ä¹Ÿè®¤ä¸º C åˆé€‚ å‹¤åŠ³çš„ TT æ”¶é›†äº†Mæ¡æ„è§ï¼Œæƒ³è¦çŸ¥é“æœ€é«˜ç¥¨æ•°ï¼Œå¹¶ç»™å‡ºä¸€ä»½å€™é€‰äººåå•ï¼Œå³æ‰€æœ‰å¾—ç¥¨æœ€å¤šçš„åŒå­¦ï¼Œä½ èƒ½å¸®å¸®ä»–å—ï¼Ÿ

##### è¾“å…¥

æœ¬é¢˜æœ‰å¤šç»„æ•°æ®ã€‚ç¬¬ä¸€è¡Œ T è¡¨ç¤ºæ•°æ®ç»„æ•°ã€‚æ¯ç»„æ•°æ®å¼€å§‹æœ‰ä¸¤ä¸ªæ•´æ•° N å’Œ M (2 <= n <= 5000, 0 <m <= 30000)ï¼Œæ¥ä¸‹æ¥æœ‰ M è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° A å’Œ B(A != B) è¡¨ç¤º A è®¤ä¸º B åˆé€‚ã€‚

##### è¾“å‡º

å¯¹äºæ¯ç»„æ•°æ®ï¼Œç¬¬ä¸€è¡Œè¾“å‡º â€œCase x: â€ï¼Œx è¡¨ç¤ºæ•°æ®çš„ç¼–å·ï¼Œä»1å¼€å§‹ï¼Œç´§è·Ÿç€æ˜¯æœ€é«˜çš„ç¥¨æ•°ã€‚ æ¥ä¸‹æ¥ä¸€è¡Œè¾“å‡ºå¾—ç¥¨æœ€å¤šçš„åŒå­¦çš„ç¼–å·ï¼Œç”¨ç©ºæ ¼éš”å¼€ï¼Œä¸å¿½ç•¥è¡Œæœ«ç©ºæ ¼ï¼

#### é¢˜ç›®åˆ†æ

- å…³é”®å¥ï¼š A è®¤ä¸º B åˆé€‚ï¼ŒB è®¤ä¸º C åˆé€‚ï¼Œåˆ™ A ä¹Ÿè®¤ä¸º C åˆé€‚ã€‚é‚£ä¹ˆåŒä¸€è¿é€šå—é‡Œçš„äººå¯ä»¥è·å¾—ï¼š
  - å…¶æ‰€åœ¨è¿é€šå—ä¸­çš„æ‰€æœ‰äººçš„ç¥¨
  - è¿åˆ°è¯¥è¿é€šå—çš„æ‰€æœ‰å…¶ä»–è¿é€šå—çš„ç¥¨
- é‚£ä¹ˆç›´æ¥å°†è¿é€šå—ç¼©ä¸ºç‚¹ï¼Œç‚¹æƒå³ä¸ºè¯¥è¿é€šå—çš„å¤§å°ã€‚
- å¦‚ä½•æ±‚æœ€å¤šçš„ï¼Ÿ
  - ç›´æ¥éå†ï¼Ÿå®æ“æ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºå¯èƒ½ä¼šæœ‰å¤šä¸ªå…¥åº¦ä¸º0çš„ç‚¹ï¼Œè¿™äº›ç‚¹å¯èƒ½ä¼šæœ‰ç›¸åŒçš„åä»£ï¼Œå› æ­¤è¿˜è¦åˆ¤æ–­æŸè¿é€šå—çš„ç¥¨æ•°æ˜¯å¦å·²ç»åŠ è¿‡balabalaã€‚ã€‚ã€‚
  - ä¸éš¾æƒ³åˆ°**è·å¾—ç¥¨æ•°æœ€å¤šçš„è¿é€šå—å¿…ç„¶æ˜¯æ²¡æœ‰å‡ºè¾¹çš„**ã€‚å› ä¸ºå¦‚æœæœ‰å‡ºè¾¹ï¼Œé‚£ä¹ˆè¯¥è¾¹è¿åˆ°çš„å¦ä¸€è¿é€šå—çš„ç¥¨æ•°å¿…ç„¶æ¯”å½“å‰è¿é€šå—å¤šï¼›
  - é‚£ä¹ˆä¸å¦‚ç›´æ¥æ„é€ ç¼©ç‚¹ä¹‹åçš„**åå‘å›¾**ï¼Œé‚£å°±å¯ä»¥ä»æ‰€æœ‰**å…¥åº¦**ä¸º0çš„èŠ‚ç‚¹ï¼ˆå¯èƒ½æˆä¸ºç­”æ¡ˆçš„èŠ‚ç‚¹ï¼‰èµ·éå†è€Œä¸ç”¨è€ƒè™‘é‡å¤é—®é¢˜äº†ï¼Œå› ä¸ºè¿™æ ·ä¸€æ¬¡å°±å¯ä»¥è€ƒè™‘åˆ°**æ‰€æœ‰èƒ½åˆ°è¾¾å€™é€‰ç‚¹çš„ç‚¹**ã€‚ç›´æ¥è®°å½•ç‚¹æƒå’Œå³å¯ç®—å‡ºæŸä¸€å€™é€‰ç‚¹çš„æœ€ç»ˆç¥¨æ•°ã€‚
- äº¿ç‚¹ç‚¹ç»†èŠ‚ï¼š
  - å¤šç»„æ•°æ®è®°å¾—æ¸…ç©º
  - ä¾æ—§å¡vector
  - è¾“å‡ºæŒ‰ç…§å­—å…¸åºæ’åˆ—
  - scntæ˜¯ç¼©ç‚¹çš„ä¸ªæ•°ï¼Œnæ˜¯ç‚¹çš„ä¸ªæ•°ï¼Œdfnæ˜¯ç‚¹å¯¹åº”dfsé€†ååºçš„ç¼–å·ä¸æ˜¯ç‚¹çš„ç¼–å·ï¼Œè«è¦ææ··

#### ä»£ç 

```c++
using namespace std;
const int N  = 5010;
int c[N],dfn[N],vis[N],dcnt,scnt,ct[N],d[N],vote[N];
int n,m;
struct rec{
    int v,next;
}G1[N*10],G2[N*10],G[N*10];
int head[N],head1[N],head2[N],p,p1,p2;
bool v[N];
void add(int u,int v,rec g[],int& pp,int hd[]){
    pp++;
    g[pp].v = v;
    g[pp].next = hd[u];
    hd[u] = pp;
}
void dfs1(int x){
    vis[x] = 1;
    for(int e = head1[x];e;e = G1[e].next){
        int y = G1[e].v;
        if(!vis[y]) dfs1(y);
    }
    dfn[++dcnt] = x;
}
void dfs2(int x){
    c[x] = scnt;
    ++ct[scnt];
    for(int e = head2[x];e;e = G2[e].next){
        int y = G2[e].v;
        if(!c[y]) dfs2(y);
    }
}
void kosaraju(){
    dcnt = scnt = 0;
    memset(c,0,sizeof(c));
    memset(vis,0,sizeof(vis));
    for(int i = 0;i<n;i++){
        if(!vis[i]) dfs1(i);
    }
    for(int i = n-1;i>=0;i--){
        if(!c[dfn[i]]) ++scnt,dfs2(dfn[i]);
    }
}
int dfs(int x){
    v[x] = 1;
    int sum = ct[x];
    for(int e = head[x];e;e = G[e].next){
        int y = G[e].v;
        if(!v[y]) sum += dfs(y);
    }
    return sum;
}
int main(){
    int T,k=0;
    cin>>T;
    while(k++<T){
        cin>>n>>m;
        for(int i = 1;i<=m;i++){
            int a,b;
            cin>>a>>b;
            add(a,b,G1,p1,head1);
            add(b,a,G2,p2,head2);
        }
        kosaraju();
        for(int i = 0;i<n;i++){
            for(int e = head1[i];e;e = G1[e].next){
                int y = G1[e].v;
                if(c[y] != c[i]){
                    add(c[y],c[i],G,p,head);
                    d[c[i]]++;
                }
            }
        }
        int ans = 0;
        for(int i = 1;i<=scnt;i++){
            if(d[i] == 0){
                memset(v,0,sizeof(v));
                vote[i] = dfs(i);
                ans = max(ans,vote[i]);
            }
        }
        cout<<"Case "<<k<<": "<<ans-1<<"\n";
        vector<int> anses;
        for(int i = 0;i<n;i++){
            if(vote[c[i]] == ans){
                anses.push_back(i);
            }
        }
        cout<<anses[0];
        for(int i = 1;i < anses.size();i++) cout<<" "<<anses[i];
        cout<<"\n";
        for(int i = 0;i <= scnt;i++) ct[i] = d[i] = vote[i] = 0 ;
        for(int i = 0;i<= n;i++) head[i] = head1[i] = head2[i] = 0;
        p = p1 = p2 = 0;
    }
}
```

